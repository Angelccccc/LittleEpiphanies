<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>little epiphanies</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
  <meta name="description" content="Because what is life without a little bit of reflection and fun." />
</head>
<body>
  <header class="site-header">
    <h1>little epiphanies</h1>
    <p class="tagline">notes & small epiphanies</p>
  </header>

  <main class="container">
    <h2>Archive</h2>
    <div id="archive"></div>
  </main>

  <footer class="site-footer container">
    <small>© <span id="year"></span> Me</small>
  </footer>

  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Render archive from posts.json
    (async function () {
      const res = await fetch('posts.json', { cache: 'no-store' });
      const posts = await res.json();

      // Sort newest first
      posts.sort((a, b) => new Date(b.date) - new Date(a.date));

      // Group by Year -> Month (MM)
      const groups = {};
      for (const p of posts) {
        const d = new Date(p.date);
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, '0');
        groups[y] ??= {};
        groups[y][m] ??= [];
        groups[y][m].push(p);
      }

      // Render
      const root = document.getElementById('archive');
      const years = Object.keys(groups).sort((a, b) => b - a); // desc

      for (const year of years) {
        const section = document.createElement('section');
        section.innerHTML = `<h2>${year}</h2>`;
        const months = Object.keys(groups[year]).sort((a, b) => b.localeCompare(a)); // "12".."01"

        for (const month of months) {
          const monthName = new Date(`${year}-${month}-01`).toLocaleString(undefined, { month: 'long' });
          const listItems = groups[year][month].map(p => {
            const d = new Date(p.date);
            const label = d.toLocaleDateString(undefined, { month: 'short', day: '2-digit' });
            return `<li><a href="${p.path}">${label} — ${p.title}</a></li>`;
          }).join('');

          section.insertAdjacentHTML('beforeend', `
            <h3>${monthName}</h3>
            <ul class="post-list">${listItems}</ul>
          `);
        }

        root.appendChild(section);
      }
    })();
  </script>
</body>
</html>
